<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="wrapper">
        <table id="calculator">
            <tr>
                <th colspan="4"><input type="text" disabled value="0" id="display-screen"></th>
            </tr>
            <tr>
                <td><button type="button" id="" class="btn btn-operator">(</button></td>
                <td><button type="button" id="" class="btn btn-operator">)</button></td>
                <td><button type="button" id="" class="btn btn-operator">%</button></td>
                <td><button type="button" class="btn btn-operator" id="ac">AC</button></td>
            </tr>
            <tr>
                <td><button type="button" class="btn btn-number" id="seven">7</button></td>
                <td><button type="button" class="btn btn-number" id="eight">8</button> </td>
                <td><button type="button" class="btn btn-number" id="nine">9</button> </td>
                <td><button type="button" id="divide" class="btn-operator">/</button> </td>
            </tr>
            <tr>
                <td><button type="button " class="btn btn-number" id="four">4</button> </td>
                <td><button type="button " class="btn btn-number" id="five">5</button> </td>
                <td><button type="button " class="btn btn-number" id="six">6</button> </td>
                <td><button type="button" id="multiple" class="btn btn-operator">*</button> </td>
            </tr>
            <tr>
                <td><button type="button " class="btn btn-number" id="one">1</button></td>
                <td><button type="button " class="btn btn-number" id="two">2</button> </td>
                <td><button type="button " class="btn btn-number" id="three">3</button> </td>
                <td><button type="button" id="minus" class="btn btn-operator">-</button> </td>
            </tr>
            <tr>
                <td><button type="button " class="btn btn-number" id="">0</button> </td>
                <td><button type="button" id="" class="btn btn-number">.</button> </td>
                <td><button type="button" id="equal" class="btn btn-operator">=</button> </td>
                <td><button type="button" id="plus" class="btn btn-operator">+</button> </td>
            </tr>
        </table>
    </div>
    <script>
        // expression processing
        function tokenize(expr) {
            return expr.match(/\d+(\.\d+)?|\+|\-|\*|\/|\(|\)|\.|\%/g);
        }
        function toRPN(tokens) {
            let stack = [];
            let output = [];
            let predecence = {
                "+": 1, "-": 1,
                "*": 2, "/": 2
            }
            tokens.forEach(token => {
                if (!isNaN(token)) {
                    output.push(token);
                }
                else if (token === "(") {
                    stack.push(token);
                }
                else if (token === ")") {
                    while (stack.length != 0 && stack[stack.length - 1] !== "(") {
                        output.push(stack[stack.length - 1]);
                        stack.pop();
                    }
                    stack.pop();
                }
                else {
                    while (stack.length != 0 && predecence[stack[stack.length - 1]] >= predecence[token]) {
                        output.push(stack[stack.length - 1]);
                        stack.pop();
                    }
                    stack.push(token);
                }
            });
            while (stack.length != 0) {
                output.push(stack[stack.length - 1]);
                stack.pop();
            }
            return output;
        }
        function evalRPN(rpnTokens) {
            let stack = [];
            rpnTokens.forEach((token) => {
                if (!isNaN(token)) {
                    stack.push(token);
                } else {
                    let b = +stack[stack.length - 1];
                    stack.pop();
                    let a = stack.length !== 0 ? +stack[stack.length - 1] : 0;
                    stack.pop();
                    switch (token) {
                        case '+':
                            stack.push(a + b);
                            break;
                        case '-':
                            stack.push(a - b);
                            break;
                        case '*':
                            stack.push(a * b);
                            break;
                        case '/':
                            stack.push(a / b);
                            break;
                        case '%':
                            stack.push(a % b);
                    }
                }
            });
            let output = stack[0];
            return output;
        }
        // button clicked processing
        function clickEqual(expression) {
            let tokens = tokenize(expression);
            let rpnTokens = toRPN(tokens);
            let result = evalRPN(rpnTokens);
            display.value = result;
        }
        function clickAllClear() {
            display.value = "0";
        }
        function clickButton(event) {
            if (display.value === "0") {
                display.value = "";
            }
            display.value += event.target.innerText;
        }
        
        let buttons = document.getElementsByClassName("btn");
        let display = document.getElementById("display-screen");
        
        //trigger buttons clicked
        Array.from(buttons).forEach((button) => {
            button.addEventListener('click', function (event) {
                switch (event.target.id) {
                    case "equal":
                        clickEqual(display.value);
                        break;
                    case "ac":
                        clickAllClear();
                        break;
                    default:
                        clickButton(event);
                        break;
                }
            })
        })
    </script>
</body>

</html>